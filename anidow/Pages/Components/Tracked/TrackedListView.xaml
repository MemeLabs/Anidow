<UserControl
    x:Class="Anidow.Pages.Components.Tracked.TrackedListView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:adonisUi="clr-namespace:AdonisUI;assembly=AdonisUI"
    xmlns:converters="clr-namespace:Anidow.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:enums="clr-namespace:Anidow.Enums"
    xmlns:extensions="clr-namespace:AdonisUI.Extensions;assembly=AdonisUI"
    xmlns:helpers="clr-namespace:Anidow.Helpers"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:local="clr-namespace:Anidow.Pages.Components"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:Anidow.Database.Models"
    xmlns:pages="clr-namespace:Anidow.Pages"
    xmlns:s="https://github.com/canton7/Stylet"
    xmlns:system="clr-namespace:System;assembly=System.Runtime"
    xmlns:tracked="clr-namespace:Anidow.Pages.Components.Tracked"
    d:DataContext="{d:DesignInstance pages:TrackedViewModel}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>
        <helpers:BindingProxy x:Key="ProxyContext" Data="{Binding}" />
    </UserControl.Resources>

    <ItemsControl ItemsSource="{Binding Items}" Style="{StaticResource ItemsControlVirtualizedStyle}">
        <ItemsControl.ItemTemplate>
            <DataTemplate DataType="models:Anime">
                <Border Margin="4" CornerRadius="8">
                    <Border.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Status">
                                <MenuItem
                                    s:View.ActionTarget="{Binding Data, Source={StaticResource ProxyContext}}"
                                    Command="{s:Action SetToAiring,
                                                       NullTarget=Disable}"
                                    CommandParameter="{Binding}"
                                    Header="Watching"
                                    IsChecked="{Binding IsAiring, Mode=OneWay}" />
                                <MenuItem
                                    s:View.ActionTarget="{Binding Data, Source={StaticResource ProxyContext}}"
                                    Command="{s:Action SetToFinished,
                                                       NullTarget=Disable}"
                                    CommandParameter="{Binding}"
                                    Header="Finished"
                                    IsChecked="{Binding IsFinished, Mode=OneWay}" />
                            </MenuItem>
                            <MenuItem
                                s:View.ActionTarget="{Binding Data, Source={StaticResource ProxyContext}}"
                                Command="{s:Action Delete,
                                                   NullTarget=Disable}"
                                CommandParameter="{Binding}"
                                Header="Delete"
                                Icon="{iconPacks:FontAwesome TrashSolid}" />

                        </ContextMenu>
                    </Border.ContextMenu>

                    <Expander extensions:LayerExtension.IncreaseLayer="True" Style="{StaticResource ExpanderCustom}">
                        <Expander.Header>
                            <Grid>
                                <Grid.Resources>
                                    <Style TargetType="Grid">
                                        <Style.Setters>
                                            <Setter Property="TextElement.Foreground" Value="White" />
                                        </Style.Setters>
                                    </Style>
                                </Grid.Resources>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Border
                                    Width="15"
                                    Height="15"
                                    VerticalAlignment="Center"
                                    Background="{Binding Status, Converter={x:Static converters:AnimeStatusToColorConverter.Instance}}"
                                    CornerRadius="5"
                                    ToolTip="{Binding Status, Mode=OneWay}" />

                                <TextBlock
                                    Grid.Column="1"
                                    Margin="4,0,8,0"
                                    VerticalAlignment="Center"
                                    FontWeight="Bold"
                                    Text="{Binding Name}"
                                    TextTrimming="CharacterEllipsis"
                                    TextWrapping="NoWrap">
                                    <TextBlock.ToolTip>
                                        <TextBlock>
                                            <TextBlock.Text>
                                                <MultiBinding StringFormat="{}{0} - {1}">
                                                    <Binding Path="Name" />
                                                    <Binding Path="Group" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </TextBlock.ToolTip>
                                </TextBlock>

                                <TextBlock
                                    Grid.Column="2"
                                    VerticalAlignment="Center"
                                    Opacity=".7"
                                    Text="{Binding Group}"
                                    TextTrimming="CharacterEllipsis"
                                    TextWrapping="NoWrap"
                                    ToolTip="{Binding Group}" />
                            </Grid>
                        </Expander.Header>
                        <tracked:TrackedAnimeEditContentView DataContext="{Binding}" />
                    </Expander>
                </Border>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl>
</UserControl>
