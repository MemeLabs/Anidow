<UserControl
    x:Class="Anidow.Pages.Components.Tracked.TrackedCardViewItem"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:adonisUi="clr-namespace:AdonisUI;assembly=AdonisUI"
    xmlns:converters="clr-namespace:Anidow.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:extensions="clr-namespace:AdonisUI.Extensions;assembly=AdonisUI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:s="https://github.com/canton7/Stylet"
    Width="140"
    Height="190"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <Grid SnapsToDevicePixels="True">
        <Border
            Margin="2.5,8,2.5,0"
            Background="{DynamicResource {x:Static adonisUi:Brushes.Layer1BackgroundBrush}}"
            BorderThickness="2"
            MouseDown="{s:Action CardEditAnime}">
            <Border.Style>
                <Style TargetType="Border">
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static adonisUi:Brushes.AccentHighlightBrush}}" />
                            <Setter Property="Cursor" Value="Hand" />
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="False">
                            <Setter Property="BorderBrush" Value="Transparent" />
                        </Trigger>
                        <DataTrigger Binding="{Binding TrackedViewSelected}" Value="True">
                            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static adonisUi:Brushes.AccentHighlightBrush}}" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Image
                    Grid.RowSpan="2"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    RenderOptions.BitmapScalingMode="HighQuality"
                    Source="{Binding CoverData.FilePath, IsAsync=True}"
                    Stretch="UniformToFill"
                    Visibility="{Binding CoverData.File, Converter={x:Static converters:IsNullToVisibilityConverter.Instance}}" />
                <StackPanel
                    Grid.Row="0"
                    Margin="8"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="{Binding CoverData.File, Converter={x:Static converters:IsNotNullToVisibilityConverter.Instance}}">
                    <TextBox x:Name="CoverUrl" extensions:WatermarkExtension.Watermark="Url ..." />
                    <Button Command="{s:Action DownloadCover, ActionNotFound=Disable}" Content="Download Cover">
                        <Button.CommandParameter>
                            <MultiBinding Converter="{x:Static converters:DownloadCoverConverter.Instance}">
                                <Binding ElementName="CoverUrl" Path="Text" />
                                <Binding />
                            </MultiBinding>
                        </Button.CommandParameter>
                    </Button>
                </StackPanel>

                <Grid
                    Grid.Row="1"
                    Background="Black"
                    Opacity=".4" />
                <Grid
                    Grid.Row="1"
                    Height="45"
                    HorizontalAlignment="Stretch">
                    <TextBlock
                        Margin="4"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="12"
                        FontWeight="Bold"
                        Foreground="White"
                        Text="{Binding Name}"
                        TextTrimming="CharacterEllipsis"
                        TextWrapping="Wrap"
                        ToolTip="{Binding Name}"
                        ToolTipService.Placement="Top" />
                </Grid>
                <Polygon
                    Grid.Row="0"
                    Fill="{Binding Status, Converter={x:Static converters:AnimeStatusToColorConverter.Instance}}"
                    Points="0,0 20,0, 0,20"
                    ToolTip="{Binding Status, Mode=OneWay}" />
            </Grid>
        </Border>
    </Grid>

</UserControl>